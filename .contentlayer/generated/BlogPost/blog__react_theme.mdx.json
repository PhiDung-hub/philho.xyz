{
  "title": "Dark mode in React and Tailwind.js",
  "date": "2023-05-07T00:00:00Z",
  "modifiedTime": "2023-05-07T00:00:00Z",
  "summary": "How to properly create a theme manager in react-next.js, without flashing effect (FOUC).",
  "image": "blogs/react_theme.webp",
  "body": {
    "raw": "\n# Problem statement\n\nWe will implement a theme manager that can toggle between dark and light theme. The tech stack is **_React_** and **_Tailwind.js_**.\n\n# First approach\n\nIf we look at the following snippet from [tailwind docs](https://tailwindcss.com/docs/dark-mode#supporting-system-preference-and-manual-selection)\n\n```javascript\n// On page load or when changing themes, best to add inline in `head` to avoid FOUC.\nif (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {\n  document.documentElement.classList.add('dark');\n} else {\n  document.documentElement.classList.remove('dark');\n}\n\n// Whenever the user explicitly chooses light mode\nlocalStorage.theme = 'light';\n\n// Whenever the user explicitly chooses dark mode\nlocalStorage.theme = 'dark';\n\n// Whenever the user explicitly chooses to respect the OS preference\nlocalStorage.removeItem('theme');\n```\n\nthen transform it into pure React using useEffect and useState hooks:\n\n```typescript\n// file: DarkModeProvider.ts\n\n'use client'; // for Next.JS 13 with `appDir`\n\nimport React, { createContext, useContext, useEffect } from 'react';\nimport { useLocalStorage } from '~/hooks';\nimport { Dispatch, SetStateAction, useEffect, useState, useDebugValue } from 'react';\n\ntype SetValue<T> = Dispatch<SetStateAction<T>>;\n\nfunction useLocalStorage<T>(key: string, initialValue?: T | (() => T)): [T, SetValue<T>] {\n  // Pass initial state function to useState so logic is only executed once\n  const [storedValue, setStoredValue] = useState<T>(initialValue as T);\n  useDebugValue(storedValue);\n\n  useEffect(() => {\n    if (initialValue != storedValue) {\n      localStorage.setItem(key, JSON.stringify(storedValue));\n    }\n  }, [key, initialValue, storedValue]);\n\n  useEffect(() => {\n    const currentValue = localStorage.getItem(key);\n    if (currentValue) setStoredValue(parse(currentValue));\n  }, [key]);\n\n  return [storedValue, setStoredValue];\n}\n// A wrapper for \"JSON.parse()\"\" to support \"undefined\" value\nfunction parse(value: string) {\n  try {\n    return JSON.parse(value);\n  } catch {\n    return value;\n  }\n}\n\ninterface UseDarkModeOutput {\n  isDarkMode: boolean;\n  toggle: () => void;\n}\n\n// Create a new context for the dark mode state\nexport const DarkModeContext = createContext<UseDarkModeOutput>({\n  isDarkMode: true,\n  toggle: () => {},\n  enable: () => {},\n  disable: () => {},\n});\n\nexport const DarkModeProvider = ({ children }: { children: React.ReactNode }) => {\n  const [isDarkMode, setDarkMode] = useLocalStorage<boolean>('is-dark-mode');\n\n  useEffect(() => {\n    const root = window.document.documentElement.classList;\n    if (isDarkMode) {\n      root.add('dark');\n    } else {\n      root.remove('dark');\n    }\n  }, [isDarkMode]);\n\n  const toggle = () => setDarkMode((prev) => !prev);\n\n  const value: UseDarkModeOutput = {\n    isDarkMode,\n    toggle,\n  };\n\n  return <DarkModeContext.Provider value={value}>{children}</DarkModeContext.Provider>;\n};\n\n// Create a custom hook that will allow other components to access the dark mode state\nexport const useDarkMode = () => useContext(DarkModeContext);\n```\n\nand finally using the defined provider in our main app:\n\n```typescript\nimport { DarkModeProvider } from '~/providers/DarkModeProvider'; // from `DarkModeProvider.ts`\n\nconst RootLayout = ({ children }: { children: React.ReactNode }) => {\n  return (\n    <DarkModeProvider>\n      <html lang=\"en\">\n        {/* Other layout components */}\n        {children}\n      </html>\n    </DarkModeProvider>\n  );\n};\n\nexport default RootLayout;\n```\n\n## FOUC (flash of unstyled content)\n\nThe snippet using `DarkModeProvider` above will suffered from FOUC because React `useEffect` hook does not work as intended on hydration, \ni.e. the `useEffect` hook will execute twice (one on initial hyrdation and another after DOM fully drawn), causing the screen to be flashed as below.\n\nTherefore, we will need another solution, which use only bare metal Javascript. In fact, I adopt the idea from [react.dev](https://react.dev/). \nThe relevant portion of code can be seen on their github repository:\n- [`_document.tsx`](https://github.com/reactjs/react.dev/blob/main/src/pages/_document.tsx) \n- [`TopNav.tsx`](https://github.com/reactjs/react.dev/blob/main/src/components/Layout/TopNav/TopNav.tsx)\n",
    "code": "var Component=(()=>{var lr=Object.create;var M=Object.defineProperty;var cr=Object.getOwnPropertyDescriptor;var ur=Object.getOwnPropertyNames;var dr=Object.getPrototypeOf,fr=Object.prototype.hasOwnProperty;var J=(u,t)=>()=>(t||u((t={exports:{}}).exports,t),t.exports),mr=(u,t)=>{for(var h in t)M(u,h,{get:t[h],enumerable:!0})},ye=(u,t,h,x)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let g of ur(t))!fr.call(u,g)&&g!==h&&M(u,g,{get:()=>t[g],enumerable:!(x=cr(t,g))||x.enumerable});return u};var br=(u,t,h)=>(h=u!=null?lr(dr(u)):{},ye(t||!u||!u.__esModule?M(h,\"default\",{value:u,enumerable:!0}):h,u)),pr=u=>ye(M({},\"__esModule\",{value:!0}),u);var we=J((yr,Ne)=>{Ne.exports=React});var Ee=J(q=>{\"use strict\";(function(){\"use strict\";var u=we(),t=Symbol.for(\"react.element\"),h=Symbol.for(\"react.portal\"),x=Symbol.for(\"react.fragment\"),g=Symbol.for(\"react.strict_mode\"),z=Symbol.for(\"react.profiler\"),X=Symbol.for(\"react.provider\"),H=Symbol.for(\"react.context\"),k=Symbol.for(\"react.forward_ref\"),F=Symbol.for(\"react.suspense\"),V=Symbol.for(\"react.suspense_list\"),j=Symbol.for(\"react.memo\"),A=Symbol.for(\"react.lazy\"),je=Symbol.for(\"react.offscreen\"),K=Symbol.iterator,Se=\"@@iterator\";function Ce(e){if(e===null||typeof e!=\"object\")return null;var r=K&&e[K]||e[Se];return typeof r==\"function\"?r:null}var N=u.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function m(e){{for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];Oe(\"error\",e,n)}}function Oe(e,r,n){{var o=N.ReactDebugCurrentFrame,l=o.getStackAddendum();l!==\"\"&&(r+=\"%s\",n=n.concat([l]));var c=n.map(function(s){return String(s)});c.unshift(\"Warning: \"+r),Function.prototype.apply.call(console[e],console,c)}}var De=!1,Pe=!1,Me=!1,Fe=!1,Ve=!1,Z;Z=Symbol.for(\"react.module.reference\");function Ae(e){return!!(typeof e==\"string\"||typeof e==\"function\"||e===x||e===z||Ve||e===g||e===F||e===V||Fe||e===je||De||Pe||Me||typeof e==\"object\"&&e!==null&&(e.$$typeof===A||e.$$typeof===j||e.$$typeof===X||e.$$typeof===H||e.$$typeof===k||e.$$typeof===Z||e.getModuleId!==void 0))}function Ie(e,r,n){var o=e.displayName;if(o)return o;var l=r.displayName||r.name||\"\";return l!==\"\"?n+\"(\"+l+\")\":n}function Q(e){return e.displayName||\"Context\"}function _(e){if(e==null)return null;if(typeof e.tag==\"number\"&&m(\"Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue.\"),typeof e==\"function\")return e.displayName||e.name||null;if(typeof e==\"string\")return e;switch(e){case x:return\"Fragment\";case h:return\"Portal\";case z:return\"Profiler\";case g:return\"StrictMode\";case F:return\"Suspense\";case V:return\"SuspenseList\"}if(typeof e==\"object\")switch(e.$$typeof){case H:var r=e;return Q(r)+\".Consumer\";case X:var n=e;return Q(n._context)+\".Provider\";case k:return Ie(e,e.render,\"ForwardRef\");case j:var o=e.displayName||null;return o!==null?o:_(e.type)||\"Memo\";case A:{var l=e,c=l._payload,s=l._init;try{return _(s(c))}catch{return null}}}return null}var y=Object.assign,R=0,ee,re,ne,te,oe,ae,ie;function se(){}se.__reactDisabledLog=!0;function Le(){{if(R===0){ee=console.log,re=console.info,ne=console.warn,te=console.error,oe=console.group,ae=console.groupCollapsed,ie=console.groupEnd;var e={configurable:!0,enumerable:!0,value:se,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}R++}}function We(){{if(R--,R===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:y({},e,{value:ee}),info:y({},e,{value:re}),warn:y({},e,{value:ne}),error:y({},e,{value:te}),group:y({},e,{value:oe}),groupCollapsed:y({},e,{value:ae}),groupEnd:y({},e,{value:ie})})}R<0&&m(\"disabledDepth fell below zero. This is a bug in React. Please file an issue.\")}}var I=N.ReactCurrentDispatcher,L;function S(e,r,n){{if(L===void 0)try{throw Error()}catch(l){var o=l.stack.trim().match(/\\n( *(at )?)/);L=o&&o[1]||\"\"}return`\n`+L+e}}var W=!1,C;{var Ye=typeof WeakMap==\"function\"?WeakMap:Map;C=new Ye}function le(e,r){if(!e||W)return\"\";{var n=C.get(e);if(n!==void 0)return n}var o;W=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var c;c=I.current,I.current=null,Le();try{if(r){var s=function(){throw Error()};if(Object.defineProperty(s.prototype,\"props\",{set:function(){throw Error()}}),typeof Reflect==\"object\"&&Reflect.construct){try{Reflect.construct(s,[])}catch(v){o=v}Reflect.construct(e,[],s)}else{try{s.call()}catch(v){o=v}e.call(s.prototype)}}else{try{throw Error()}catch(v){o=v}e()}}catch(v){if(v&&o&&typeof v.stack==\"string\"){for(var i=v.stack.split(`\n`),b=o.stack.split(`\n`),d=i.length-1,f=b.length-1;d>=1&&f>=0&&i[d]!==b[f];)f--;for(;d>=1&&f>=0;d--,f--)if(i[d]!==b[f]){if(d!==1||f!==1)do if(d--,f--,f<0||i[d]!==b[f]){var p=`\n`+i[d].replace(\" at new \",\" at \");return e.displayName&&p.includes(\"<anonymous>\")&&(p=p.replace(\"<anonymous>\",e.displayName)),typeof e==\"function\"&&C.set(e,p),p}while(d>=1&&f>=0);break}}}finally{W=!1,I.current=c,We(),Error.prepareStackTrace=l}var E=e?e.displayName||e.name:\"\",xe=E?S(E):\"\";return typeof e==\"function\"&&C.set(e,xe),xe}function $e(e,r,n){return le(e,!1)}function Ue(e){var r=e.prototype;return!!(r&&r.isReactComponent)}function O(e,r,n){if(e==null)return\"\";if(typeof e==\"function\")return le(e,Ue(e));if(typeof e==\"string\")return S(e);switch(e){case F:return S(\"Suspense\");case V:return S(\"SuspenseList\")}if(typeof e==\"object\")switch(e.$$typeof){case k:return $e(e.render);case j:return O(e.type,r,n);case A:{var o=e,l=o._payload,c=o._init;try{return O(c(l),r,n)}catch{}}}return\"\"}var D=Object.prototype.hasOwnProperty,ce={},ue=N.ReactDebugCurrentFrame;function P(e){if(e){var r=e._owner,n=O(e.type,e._source,r?r.type:null);ue.setExtraStackFrame(n)}else ue.setExtraStackFrame(null)}function Be(e,r,n,o,l){{var c=Function.call.bind(D);for(var s in e)if(c(e,s)){var i=void 0;try{if(typeof e[s]!=\"function\"){var b=Error((o||\"React class\")+\": \"+n+\" type `\"+s+\"` is invalid; it must be a function, usually from the `prop-types` package, but received `\"+typeof e[s]+\"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.\");throw b.name=\"Invariant Violation\",b}i=e[s](r,s,o,n,null,\"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED\")}catch(d){i=d}i&&!(i instanceof Error)&&(P(l),m(\"%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).\",o||\"React class\",n,s,typeof i),P(null)),i instanceof Error&&!(i.message in ce)&&(ce[i.message]=!0,P(l),m(\"Failed %s type: %s\",n,i.message),P(null))}}}var Ge=Array.isArray;function Y(e){return Ge(e)}function Je(e){{var r=typeof Symbol==\"function\"&&Symbol.toStringTag,n=r&&e[Symbol.toStringTag]||e.constructor.name||\"Object\";return n}}function qe(e){try{return de(e),!1}catch{return!0}}function de(e){return\"\"+e}function fe(e){if(qe(e))return m(\"The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.\",Je(e)),de(e)}var T=N.ReactCurrentOwner,ze={key:!0,ref:!0,__self:!0,__source:!0},me,be,$;$={};function Xe(e){if(D.call(e,\"ref\")){var r=Object.getOwnPropertyDescriptor(e,\"ref\").get;if(r&&r.isReactWarning)return!1}return e.ref!==void 0}function He(e){if(D.call(e,\"key\")){var r=Object.getOwnPropertyDescriptor(e,\"key\").get;if(r&&r.isReactWarning)return!1}return e.key!==void 0}function Ke(e,r){if(typeof e.ref==\"string\"&&T.current&&r&&T.current.stateNode!==r){var n=_(T.current.type);$[n]||(m('Component \"%s\" contains the string ref \"%s\". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',_(T.current.type),e.ref),$[n]=!0)}}function Ze(e,r){{var n=function(){me||(me=!0,m(\"%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",r))};n.isReactWarning=!0,Object.defineProperty(e,\"key\",{get:n,configurable:!0})}}function Qe(e,r){{var n=function(){be||(be=!0,m(\"%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)\",r))};n.isReactWarning=!0,Object.defineProperty(e,\"ref\",{get:n,configurable:!0})}}var er=function(e,r,n,o,l,c,s){var i={$$typeof:t,type:e,key:r,ref:n,props:s,_owner:c};return i._store={},Object.defineProperty(i._store,\"validated\",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(i,\"_self\",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.defineProperty(i,\"_source\",{configurable:!1,enumerable:!1,writable:!1,value:l}),Object.freeze&&(Object.freeze(i.props),Object.freeze(i)),i};function rr(e,r,n,o,l){{var c,s={},i=null,b=null;n!==void 0&&(fe(n),i=\"\"+n),He(r)&&(fe(r.key),i=\"\"+r.key),Xe(r)&&(b=r.ref,Ke(r,l));for(c in r)D.call(r,c)&&!ze.hasOwnProperty(c)&&(s[c]=r[c]);if(e&&e.defaultProps){var d=e.defaultProps;for(c in d)s[c]===void 0&&(s[c]=d[c])}if(i||b){var f=typeof e==\"function\"?e.displayName||e.name||\"Unknown\":e;i&&Ze(s,f),b&&Qe(s,f)}return er(e,i,b,l,o,T.current,s)}}var U=N.ReactCurrentOwner,pe=N.ReactDebugCurrentFrame;function w(e){if(e){var r=e._owner,n=O(e.type,e._source,r?r.type:null);pe.setExtraStackFrame(n)}else pe.setExtraStackFrame(null)}var B;B=!1;function G(e){return typeof e==\"object\"&&e!==null&&e.$$typeof===t}function he(){{if(U.current){var e=_(U.current.type);if(e)return`\n\nCheck the render method of \\``+e+\"`.\"}return\"\"}}function nr(e){{if(e!==void 0){var r=e.fileName.replace(/^.*[\\\\\\/]/,\"\"),n=e.lineNumber;return`\n\nCheck your code at `+r+\":\"+n+\".\"}return\"\"}}var _e={};function tr(e){{var r=he();if(!r){var n=typeof e==\"string\"?e:e.displayName||e.name;n&&(r=`\n\nCheck the top-level render call using <`+n+\">.\")}return r}}function ve(e,r){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var n=tr(r);if(_e[n])return;_e[n]=!0;var o=\"\";e&&e._owner&&e._owner!==U.current&&(o=\" It was passed a child from \"+_(e._owner.type)+\".\"),w(e),m('Each child in a list should have a unique \"key\" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',n,o),w(null)}}function ge(e,r){{if(typeof e!=\"object\")return;if(Y(e))for(var n=0;n<e.length;n++){var o=e[n];G(o)&&ve(o,r)}else if(G(e))e._store&&(e._store.validated=!0);else if(e){var l=Ce(e);if(typeof l==\"function\"&&l!==e.entries)for(var c=l.call(e),s;!(s=c.next()).done;)G(s.value)&&ve(s.value,r)}}}function or(e){{var r=e.type;if(r==null||typeof r==\"string\")return;var n;if(typeof r==\"function\")n=r.propTypes;else if(typeof r==\"object\"&&(r.$$typeof===k||r.$$typeof===j))n=r.propTypes;else return;if(n){var o=_(r);Be(n,e.props,\"prop\",o,e)}else if(r.PropTypes!==void 0&&!B){B=!0;var l=_(r);m(\"Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?\",l||\"Unknown\")}typeof r.getDefaultProps==\"function\"&&!r.getDefaultProps.isReactClassApproved&&m(\"getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.\")}}function ar(e){{for(var r=Object.keys(e.props),n=0;n<r.length;n++){var o=r[n];if(o!==\"children\"&&o!==\"key\"){w(e),m(\"Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.\",o),w(null);break}}e.ref!==null&&(w(e),m(\"Invalid attribute `ref` supplied to `React.Fragment`.\"),w(null))}}function ir(e,r,n,o,l,c){{var s=Ae(e);if(!s){var i=\"\";(e===void 0||typeof e==\"object\"&&e!==null&&Object.keys(e).length===0)&&(i+=\" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.\");var b=nr(l);b?i+=b:i+=he();var d;e===null?d=\"null\":Y(e)?d=\"array\":e!==void 0&&e.$$typeof===t?(d=\"<\"+(_(e.type)||\"Unknown\")+\" />\",i=\" Did you accidentally export a JSX literal instead of a component?\"):d=typeof e,m(\"React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s\",d,i)}var f=rr(e,r,n,l,c);if(f==null)return f;if(s){var p=r.children;if(p!==void 0)if(o)if(Y(p)){for(var E=0;E<p.length;E++)ge(p[E],e);Object.freeze&&Object.freeze(p)}else m(\"React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.\");else ge(p,e)}return e===x?ar(f):or(f),f}}var sr=ir;q.Fragment=x,q.jsxDEV=sr})()});var Te=J((wr,Re)=>{\"use strict\";Re.exports=Ee()});var gr={};mr(gr,{default:()=>vr,frontmatter:()=>hr});var a=br(Te()),hr={title:\"Dark mode in React and Tailwind.js\",date:\"2023-05-07T00:00:00Z\",modifiedTime:\"2023-05-07T00:00:00Z\",summary:\"How to properly create a theme manager in react-next.js, without flashing effect (FOUC).\",image:\"blogs/react_theme.webp\",type:\"BlogPost\"};function ke(u){let t=Object.assign({h1:\"h1\",p:\"p\",strong:\"strong\",em:\"em\",a:\"a\",pre:\"pre\",code:\"code\",h2:\"h2\",ul:\"ul\",li:\"li\"},u.components);return(0,a.jsxDEV)(a.Fragment,{children:[(0,a.jsxDEV)(t.h1,{children:\"Problem statement\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:10,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.p,{children:[\"We will implement a theme manager that can toggle between dark and light theme. The tech stack is \",(0,a.jsxDEV)(t.strong,{children:(0,a.jsxDEV)(t.em,{children:\"React\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:12,columnNumber:101},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:12,columnNumber:99},this),\" and \",(0,a.jsxDEV)(t.strong,{children:(0,a.jsxDEV)(t.em,{children:\"Tailwind.js\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:12,columnNumber:117},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:12,columnNumber:115},this),\".\"]},void 0,!0,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:12,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.h1,{children:\"First approach\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:14,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.p,{children:[\"If we look at the following snippet from \",(0,a.jsxDEV)(t.a,{href:\"https://tailwindcss.com/docs/dark-mode#supporting-system-preference-and-manual-selection\",children:\"tailwind docs\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:16,columnNumber:42},this)]},void 0,!0,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:16,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.pre,{children:(0,a.jsxDEV)(t.code,{className:\"language-javascript\",children:`// On page load or when changing themes, best to add inline in \\`head\\` to avoid FOUC.\nif (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {\n  document.documentElement.classList.add('dark');\n} else {\n  document.documentElement.classList.remove('dark');\n}\n\n// Whenever the user explicitly chooses light mode\nlocalStorage.theme = 'light';\n\n// Whenever the user explicitly chooses dark mode\nlocalStorage.theme = 'dark';\n\n// Whenever the user explicitly chooses to respect the OS preference\nlocalStorage.removeItem('theme');\n`},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:18,columnNumber:1},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:18,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.p,{children:\"then transform it into pure React using useEffect and useState hooks:\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:36,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.pre,{children:(0,a.jsxDEV)(t.code,{className:\"language-typescript\",children:`// file: DarkModeProvider.ts\n\n'use client'; // for Next.JS 13 with \\`appDir\\`\n\nimport React, { createContext, useContext, useEffect } from 'react';\nimport { useLocalStorage } from '~/hooks';\nimport { Dispatch, SetStateAction, useEffect, useState, useDebugValue } from 'react';\n\ntype SetValue<T> = Dispatch<SetStateAction<T>>;\n\nfunction useLocalStorage<T>(key: string, initialValue?: T | (() => T)): [T, SetValue<T>] {\n  // Pass initial state function to useState so logic is only executed once\n  const [storedValue, setStoredValue] = useState<T>(initialValue as T);\n  useDebugValue(storedValue);\n\n  useEffect(() => {\n    if (initialValue != storedValue) {\n      localStorage.setItem(key, JSON.stringify(storedValue));\n    }\n  }, [key, initialValue, storedValue]);\n\n  useEffect(() => {\n    const currentValue = localStorage.getItem(key);\n    if (currentValue) setStoredValue(parse(currentValue));\n  }, [key]);\n\n  return [storedValue, setStoredValue];\n}\n// A wrapper for \"JSON.parse()\"\" to support \"undefined\" value\nfunction parse(value: string) {\n  try {\n    return JSON.parse(value);\n  } catch {\n    return value;\n  }\n}\n\ninterface UseDarkModeOutput {\n  isDarkMode: boolean;\n  toggle: () => void;\n}\n\n// Create a new context for the dark mode state\nexport const DarkModeContext = createContext<UseDarkModeOutput>({\n  isDarkMode: true,\n  toggle: () => {},\n  enable: () => {},\n  disable: () => {},\n});\n\nexport const DarkModeProvider = ({ children }: { children: React.ReactNode }) => {\n  const [isDarkMode, setDarkMode] = useLocalStorage<boolean>('is-dark-mode');\n\n  useEffect(() => {\n    const root = window.document.documentElement.classList;\n    if (isDarkMode) {\n      root.add('dark');\n    } else {\n      root.remove('dark');\n    }\n  }, [isDarkMode]);\n\n  const toggle = () => setDarkMode((prev) => !prev);\n\n  const value: UseDarkModeOutput = {\n    isDarkMode,\n    toggle,\n  };\n\n  return <DarkModeContext.Provider value={value}>{children}</DarkModeContext.Provider>;\n};\n\n// Create a custom hook that will allow other components to access the dark mode state\nexport const useDarkMode = () => useContext(DarkModeContext);\n`},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:38,columnNumber:1},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:38,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.p,{children:\"and finally using the defined provider in our main app:\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:115,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.pre,{children:(0,a.jsxDEV)(t.code,{className:\"language-typescript\",children:`import { DarkModeProvider } from '~/providers/DarkModeProvider'; // from \\`DarkModeProvider.ts\\`\n\nconst RootLayout = ({ children }: { children: React.ReactNode }) => {\n  return (\n    <DarkModeProvider>\n      <html lang=\"en\">\n        {/* Other layout components */}\n        {children}\n      </html>\n    </DarkModeProvider>\n  );\n};\n\nexport default RootLayout;\n`},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:117,columnNumber:1},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:117,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.h2,{children:\"FOUC (flash of unstyled content)\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:134,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.p,{children:[\"The snippet using \",(0,a.jsxDEV)(t.code,{children:\"DarkModeProvider\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:136,columnNumber:19},this),\" above will suffered from FOUC because React \",(0,a.jsxDEV)(t.code,{children:\"useEffect\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:136,columnNumber:82},this),` hook does not work as intended on hydration,\ni.e. the `,(0,a.jsxDEV)(t.code,{children:\"useEffect\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:137,columnNumber:10},this),\" hook will execute twice (one on initial hyrdation and another after DOM fully drawn), causing the screen to be flashed as below.\"]},void 0,!0,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:136,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.p,{children:[\"Therefore, we will need another solution, which use only bare metal Javascript. In fact, I adopt the idea from \",(0,a.jsxDEV)(t.a,{href:\"https://react.dev/\",children:\"react.dev\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:139,columnNumber:112},this),`.\nThe relevant portion of code can be seen on their github repository:`]},void 0,!0,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:139,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.ul,{children:[`\n`,(0,a.jsxDEV)(t.li,{children:(0,a.jsxDEV)(t.a,{href:\"https://github.com/reactjs/react.dev/blob/main/src/pages/_document.tsx\",children:(0,a.jsxDEV)(t.code,{children:\"_document.tsx\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:141,columnNumber:4},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:141,columnNumber:3},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:141,columnNumber:1},this),`\n`,(0,a.jsxDEV)(t.li,{children:(0,a.jsxDEV)(t.a,{href:\"https://github.com/reactjs/react.dev/blob/main/src/components/Layout/TopNav/TopNav.tsx\",children:(0,a.jsxDEV)(t.code,{children:\"TopNav.tsx\"},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:142,columnNumber:4},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:142,columnNumber:3},this)},void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:142,columnNumber:1},this),`\n`]},void 0,!0,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:141,columnNumber:1},this)]},void 0,!0,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\",lineNumber:1,columnNumber:1},this)}function _r(u={}){let{wrapper:t}=u.components||{};return t?(0,a.jsxDEV)(t,Object.assign({},u,{children:(0,a.jsxDEV)(ke,u,void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\"},this)}),void 0,!1,{fileName:\"/home/phi/side_projects/personal-website/mdx_contents/blog/_mdx_bundler_entry_point-efe270bc-7ac6-4fcd-9026-19cb48b23e53.mdx\"},this):ke(u)}var vr=_r;return pr(gr);})();\n/*! Bundled license information:\n\nreact/cjs/react-jsx-dev-runtime.development.js:\n  (**\n   * @license React\n   * react-jsx-dev-runtime.development.js\n   *\n   * Copyright (c) Facebook, Inc. and its affiliates.\n   *\n   * This source code is licensed under the MIT license found in the\n   * LICENSE file in the root directory of this source tree.\n   *)\n*/\n;return Component;"
  },
  "_id": "blog/react_theme.mdx",
  "_raw": {
    "sourceFilePath": "blog/react_theme.mdx",
    "sourceFileName": "react_theme.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/react_theme"
  },
  "type": "BlogPost",
  "slug": "react_theme"
}